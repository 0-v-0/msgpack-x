# msgpack-x

A wasm implementation of [MessagePack](http://msgpack.org)

## Usage

```js
import { encode, decode } from 'msgpack-x'

let encoded = encode({ foo: 'bar' }) // Uint8Array<81 a3 66 6f 6f a3 62 61 72>
let decoded = decode(encoded) // { foo: 'bar' }
```

## Note

- `undefined` is encoded as fixext 1 [0, 0] (d4 00 00)
- `ArrayBuffer`, `TypedArray` are encoded as ext 8/16/32 [0, data]

## Performance

Test machine: Intel Core i7-12700H DDR4 3200MHz

```
$ node -v
v20.0.0
$ cd ./benchmarks
$ node encode
+----------------------------+-------------------+-----------------+----------------+---------------+
|                            │ tiny              │ small           │ medium         │ large         |
+----------------------------+-------------------+-----------------+----------------+---------------+
| msgpack-x                  │ 424,366 ops/sec   │ 99,578 ops/sec  │ 10,129 ops/sec │ 187 ops/sec   |
+----------------------------+-------------------+-----------------+----------------+---------------+
| msgpack-js                 │ 290,598 ops/sec   │ 178,412 ops/sec │ 5,442 ops/sec  │ 5.84 ops/sec  |
+----------------------------+-------------------+-----------------+----------------+---------------+
| msgpack-lite               │ 1,026,707 ops/sec │ 392,481 ops/sec │ 36,636 ops/sec │ 574 ops/sec   |
+----------------------------+-------------------+-----------------+----------------+---------------+
| @ygoe/msgpack              │ 1,732,362 ops/sec │ 535,050 ops/sec │ 47,083 ops/sec │ 139 ops/sec   |
+----------------------------+-------------------+-----------------+----------------+---------------+
| @msgpack/msgpack           │ 1,319,636 ops/sec │ 709,452 ops/sec │ 74,107 ops/sec │ 292 ops/sec   |
+----------------------------+-------------------+-----------------+----------------+---------------+
| JSON.stringify (to Buffer) │ 3,010,791 ops/sec │ 551,019 ops/sec │ 26,417 ops/sec │ 29.89 ops/sec |
+----------------------------+-------------------+-----------------+----------------+---------------+

$ node decode
+--------------------------+-------------------+-------------------+----------------+---------------+
|                          │ tiny              │ small             │ medium         │ large         |
+--------------------------+-------------------+-------------------+----------------+---------------+
| msgpack-x                │ 1,263,085 ops/sec │ 440,102 ops/sec   │ 50,811 ops/sec │ 383 ops/sec   |
+--------------------------+-------------------+-------------------+----------------+---------------+
| msgpack-js               │ 2,141,690 ops/sec │ 340,306 ops/sec   │ 10,352 ops/sec │ 11.21 ops/sec |
+--------------------------+-------------------+-------------------+----------------+---------------+
| msgpack-lite             │ 1,280,444 ops/sec │ 280,657 ops/sec   │ 28,001 ops/sec │ 337 ops/sec   |
+--------------------------+-------------------+-------------------+----------------+---------------+
| @ygoe/msgpack            │ 5,356,840 ops/sec │ 919,307 ops/sec   │ 46,593 ops/sec │ 32.42 ops/sec |
+--------------------------+-------------------+-------------------+----------------+---------------+
| @msgpack/msgpack         │ 3,312,051 ops/sec │ 1,116,660 ops/sec │ 65,207 ops/sec │ 417 ops/sec   |
+--------------------------+-------------------+-------------------+----------------+---------------+
| JSON.parse (from Buffer) │ 3,037,648 ops/sec │ 858,013 ops/sec   │ 62,393 ops/sec │ 70.27 ops/sec |
+--------------------------+-------------------+-------------------+----------------+---------------+
```
